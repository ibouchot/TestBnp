<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Recherche de Transactions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="styles.css" rel="stylesheet">
</head>
<body>

<div class="container">
    <form id="transaction-form">
        <label for="transaction-id">ID de transaction :</label>
        <input type="text" id="transaction-id" name="transactionId" required />
        <button type="submit">Rechercher</button>
    </form>

    <script>
        document.getElementById('transaction-form').addEventListener('submit', function (event) {
            event.preventDefault();

            const id = document.getElementById('transaction-id').value;
            const url = `/transactions/${encodeURIComponent(id)}`;

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Erreur HTTP " + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('result').textContent = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    document.getElementById('result').textContent = "Erreur : " + error.message;
                });
        });
    </script>

</div>
<script>
    document.getElementById('transaction-form').addEventListener('submit', function(event) {
        event.preventDefault();

        const id = document.getElementById('transaction-id').value.trim();
        if (!id) return;

        const url = `/transactions/${encodeURIComponent(id)}`;
        const resultDiv = document.getElementById('result');

        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erreur HTTP ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (!data || data.length === 0) {
                    resultDiv.innerHTML = '<p>Aucune transaction trouvée.</p>';
                    return;
                }

                // Création d'un tableau HTML
                let html = `<table class="striped">
                <thead>
                    <tr>
                        <th>Primary ID</th>
                        <th>Secondary ID</th>
                        <th>Event Type</th>
                        <th>Date</th>
                        <th>Group ID</th>
                    </tr>
                </thead>
                <tbody>`;

                data.forEach(tx => {
                    html += `<tr>
                    <td>${tx.primaryId || ''}</td>
                    <td>${tx.secondaryId || ''}</td>
                    <td>${tx.event?.eventType || ''}</td>
                    <td>${tx.date || ''}</td>
                    <td>${tx.groupId || ''}</td>
                </tr>`;
                });

                html += '</tbody></table>';
                resultDiv.innerHTML = html;
            })
            .catch(error => {
                resultDiv.innerHTML = `<p style="color:red;">Erreur : ${error.message}</p>`;
            });
    });
</script>

</body>
</html>
